<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>מסנן רשימות מענה</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
    
    :root {
      --bg: #fafafa;
      --surface: #ffffff;
      --surface-hover: #f8f9fa;
      --border: #e5e7eb;
      --border-light: #f3f4f6;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --accent: #374151;
      --accent-hover: #1f2937;
      --success: #059669;
      --warning: #d97706;
      --danger: #dc2626;
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 8px;
      --radius-lg: 12px;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 14px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 48px;
    }
    
    h1 {
      font-size: 28px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 12px;
      letter-spacing: -0.025em;
    }
    
    .subtitle {
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 400;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    .grid {
      display: grid;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    @media (min-width: 768px) {
      .grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      transition: all 0.15s ease;
    }
    
    .card:hover {
      border-color: var(--text-muted);
    }
    
    .card-header {
      padding: 20px 24px 16px;
      border-bottom: 1px solid var(--border-light);
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 8px;
    }
    
    .card-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.5;
    }
    
    .card-content {
      padding: 20px 24px 24px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group:last-child {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 6px;
    }
    
    textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 14px;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
      line-height: 1.4;
      resize: vertical;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background: var(--surface);
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(55, 65, 81, 0.1);
    }
    
    textarea::placeholder {
      color: var(--text-muted);
    }
    
    .input-row {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    input[type="number"] {
      width: 80px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 14px;
      transition: border-color 0.15s ease;
    }
    
    input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    
    .checkbox input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--accent);
    }
    
    .checkbox label {
      margin: 0;
      font-size: 13px;
      cursor: pointer;
    }
    
    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 13px;
      font-weight: 500;
      background: var(--surface);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.15s ease;
      text-decoration: none;
    }
    
    .btn:hover {
      background: var(--surface-hover);
      border-color: var(--text-muted);
    }
    
    .btn.primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .btn.primary:hover {
      background: var(--accent-hover);
      border-color: var(--accent-hover);
    }
    
    .btn.success {
      color: var(--success);
      border-color: var(--success);
    }
    
    .btn.success:hover {
      background: rgba(5, 150, 105, 0.05);
    }
    
    .btn.warning {
      color: var(--warning);
      border-color: var(--warning);
    }
    
    .btn.warning:hover {
      background: rgba(217, 119, 6, 0.05);
    }
    
    .controls {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
    }
    
    .controls-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 20px;
    }
    
    .controls-row {
      display: flex;
      align-items: center;
      gap: 24px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .threshold-input {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .output-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
    }
    
    .output-header {
      padding: 20px 24px 16px;
      border-bottom: 1px solid var(--border-light);
    }
    
    .output-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0;
    }
    
    .output {
      padding: 20px 24px;
      min-height: 200px;
      background: #fafbfc;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
      color: var(--text-primary);
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    }
    
    .output:empty::before {
      content: 'התוצאה תופיע כאן...';
      color: var(--text-muted);
      font-style: italic;
    }
    
    .example {
      display: inline-block;
      padding: 2px 6px;
      background: #f3f4f6;
      color: var(--text-secondary);
      border-radius: 4px;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, monospace;
      margin: 0 2px;
    }
    
    .note {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 16px;
      padding: 12px 16px;
      background: #f9fafb;
      border-radius: var(--radius);
      border-left: 3px solid var(--border);
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 24px 16px;
      }
      
      .controls-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .button-group {
        flex-wrap: wrap;
      }
      
      .btn {
        flex: 1;
        justify-content: center;
        min-width: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>מסנן רשימות מענה</h1>
      <p class="subtitle">הדבק שתי רשימות: רשימת שמות ורשימת בדיקה (שם + כמות). הפלט: שמות שלא נמצאים כלל או שמספר המענה שלהם קטן מהסף.</p>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">רשימת שמות</h3>
          <p class="card-description">שם אחד בכל שורה - לדוגמה: <span class="example">שמואל שמשי</span></p>
        </div>
        <div class="card-content">
          <div class="form-group">
            <textarea id="list1" placeholder="הדבק כאן את רשימת השמות..."></textarea>
          </div>
          <div class="button-group">
            <button class="btn" id="btnSampleNames">מלא דוגמה</button>
            <button class="btn" id="btnClearNames">נקה</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">רשימת בדיקה</h3>
          <p class="card-description">שם + כמות, המספר בסוף השורה - לדוגמה: <span class="example">ארז צברי דרום 21</span></p>
        </div>
        <div class="card-content">
          <div class="form-group">
            <textarea id="list2" placeholder="הדבק כאן את רשימת השמות עם הכמויות..."></textarea>
          </div>
          <div class="form-group">
            <div class="checkbox">
              <input type="checkbox" id="stripRegion" checked />
              <label for="stripRegion">הסר מילות אזור (דרום, צפון, מרכז וכו')</label>
            </div>
          </div>
          <div class="button-group">
            <button class="btn" id="btnSampleCheck">מלא דוגמה</button>
            <button class="btn" id="btnClearCheck">נקה</button>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <h3 class="controls-title">הגדרות והרצה</h3>
      <div class="controls-row">
        <div class="threshold-input">
          <label for="threshold">סף כמות (עד וכולל):</label>
          <input type="number" id="threshold" value="40" min="0" />
        </div>
        <div class="checkbox">
          <input type="checkbox" id="dedupe" checked />
          <label for="dedupe">הסר כפילויות</label>
        </div>
        <div class="checkbox">
          <input type="checkbox" id="sortAlpha" />
          <label for="sortAlpha">מיין אלפביתית</label>
        </div>
      </div>
      <div class="button-group">
        <button class="btn primary" id="runBtn">הרץ סינון</button>
        <button class="btn success" id="copyBtn">העתק</button>
        <button class="btn warning" id="downloadBtn">הורד</button>
      </div>
      <div class="note">
        שמות שלא נמצאים ברשימת הבדיקה או שהכמות שלהם עד הסף (כולל) יופיעו בפלט.
      </div>
    </div>

    <div class="output-section">
      <div class="output-header">
        <h3 class="output-title">תוצאות</h3>
      </div>
      <div id="output" class="output"></div>
    </div>
  </div>

  <script>
   // כלים קטנים
const byId = (id) => document.getElementById(id);

// מילים להסרה בסוף שם (אם מסומן)
const REGION_WORDS = new Set(["דרום", "צפון", "מרכז", "ירושלים", "שפלה", "גליל", "נגב", "שרון", "גוש דן", "שומרון"]);

function normalizeWhitespace(str) {
  return str.replace(/[\t\u00A0\s]+/g, ' ').trim();
}

function stripTrailingRegions(name) {
  let parts = name.split(' ').filter(Boolean);
  while (parts.length && REGION_WORDS.has(parts[parts.length - 1])) {
    parts.pop();
  }
  return parts.join(' ');
}

// פרסר לרשימה 2: שם + כמות
function parseCheckList(text, { stripRegion }) {
  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
  const map = new Map(); // name -> total number

  for (const raw of lines) {
    const m = raw.match(/(-?\d+)\s*$/);
    if (!m) continue; // אין מספר בסוף → מדלגים
    const num = parseInt(m[1], 10);
    let name = raw.slice(0, raw.length - m[0].length);
    name = normalizeWhitespace(name.replace(/[ ,;:|]+$/,''));
    if (stripRegion) {
      name = stripTrailingRegions(name);
    }
    if (!name) continue;

    // סיכום כמויות עבור אותו שם
    if (map.has(name)) {
      map.set(name, map.get(name) + num);
    } else {
      map.set(name, num);
    }
  }
  return map;
}

// פרסר לרשימה 1: שמות בלבד
function parseNames(text) {
  const set = new Set();
  const lines = text.split(/\r?\n/);
  for (let line of lines) {
    line = normalizeWhitespace(line);
    if (!line) continue;
    set.add(line);
  }
  return Array.from(set);
}

function runFilter() {
  const names = parseNames(byId('list1').value);
  const threshold = Math.max(0, parseInt(byId('threshold').value || '40', 10));
  const stripRegion = byId('stripRegion').checked;
  const checkMap = parseCheckList(byId('list2').value, { stripRegion });
  const dedupe = byId('dedupe').checked;
  const sortAlpha = byId('sortAlpha').checked;

  console.log('Names from List 1:', names);
  console.log('Threshold:', threshold);
  console.log('Check Map (List 2):', Object.fromEntries(checkMap));

  let result = [];
  for (const name of names) {
    if (!checkMap.has(name)) {
      console.log(`Name "${name}" not found in List 2 → Added to result`);
      result.push(name);
    } else {
      const total = checkMap.get(name);
      console.log(`Name "${name}" found in List 2 with total ${total} → ${total <= threshold ? 'Added' : 'Not added'} to result`);
      if (total <= threshold) {
        result.push(name);
      }
    }
  }

  if (dedupe) {
    result = Array.from(new Set(result));
  }
  if (sortAlpha) {
    result.sort((a, b) => a.localeCompare(b, 'he'));
  }

  console.log('Final result:', result);
  byId('output').textContent = result.join('\n');
  return result;
}
// כפתורים
byId('runBtn').addEventListener('click', runFilter);

byId('copyBtn').addEventListener('click', async () => {
  const text = byId('output').textContent || '';
  if (!text) { alert('אין פלט להעתקה.'); return; }
  try {
    await navigator.clipboard.writeText(text);
    alert('הפלט הועתק ללוח.');
  } catch (e) {
    alert('לא הצלחתי להעתיק אוטומטית. נא לסמן ולהעתיק ידנית.');
  }
});

byId('downloadBtn').addEventListener('click', () => {
  const text = byId('output').textContent || '';
  if (!text) { alert('אין פלט להורדה.'); return; }
  const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'filtered_list.txt';
  document.body.appendChild(a);
  a.click();
  setTimeout(() => {
    URL.revokeObjectURL(url);
    a.remove();
  }, 0);
});

// דוגמאות
byId('btnSampleNames').addEventListener('click', () => {
  byId('list1').value = [
    'שמואל שמשי', 'שי לליש', 'אלעזר שררה', 'ארז צברי', 'אריאל בלונדר',
    'אשי דרעי', 'בר כספי', 'ג\'רמי', 'דוד בן דוד', 'חגית ארז',
    'חנניה פרידמן', 'מור פטר', 'מנחם פילו', 'ניר', 'נתנאל פרץ',
    'עמי ברנס', 'ראובן ירושלמי', 'שרית מכלוף'
  ].join('\n');
});

byId('btnClearNames').addEventListener('click', () => byId('list1').value = '');

byId('btnSampleCheck').addEventListener('click', () => {
  byId('list2').value = [
    'טל ברדה דרום\t112',
    'אליה כאקשור דרום\t93',
    'תמר נחמיה דרום\t75',
    'שרון אוחיון דרום\t73',
    'מאיר אבוקרט דרום\t63',
    'נועם מוסאי דרום\t62',
    'אשי דרעי דרום\t61',
    'צבי ולדמן דרום\t56',
    'חנניה פרידמן דרום\t41',
    'עדיאל משה דרום\t39',
    'ראובן ירושלמי  דרום\t30',
    'ארז צברי דרום\t21',
    'מנחם פילו דרום\t6',
    'שמואל שמשי דרום\t4',
    'חיה שאול דרום\t3',
    'ניצן חדד דרום\t1'
  ].join('\n');
});

byId('btnClearCheck').addEventListener('click', () => byId('list2').value = '');  </script>
</body>
</html>